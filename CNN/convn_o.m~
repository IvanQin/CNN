function res=convn_o(x,y,opti)
addpath('./util/');
ty=flipall(y);

sx=size(x);

sy=size(y);

if strcmp(opti,'valid') 
    bi=1-sy+sx(1:2);
else bi=sx(1:2)+sy-1;
end
bi=[bi sx(3)];

for k=1:bi(3)
    for i=1:bi(1)
        for j=1:bi(2)
        
            s=0;
            for ii=1:sy(1)
                for jj=1:sy(2)
                   
                        if strcmp(opti,'valid') 
                            tmp=x(i+ii-1,j+jj-1,k+kk-1)*y(ii,jj);
                        elseif i-sy(1)+ii>0 && j-sy(2)+jj>0 && k-sy(3)+kk>0 && i-sy(1)+ii<=sx(1) && j-sy(2)+jj<=sx(2) && k-sy(3)+kk<=sx(3)
                            tmp=x(i-sy(1)+ii,j-sy(2)+jj,k-sy(3)+kk)*y(ii,jj,kk);
                        else tmp=0;
                        end
                        if tmp<1e-6
                        %    ti=ti+1;
                        end
                        %total=total+1;
                        s=s+tmp;
                    end
                end
            end
            res(i,j,k)=s;   
        end
    end
end
